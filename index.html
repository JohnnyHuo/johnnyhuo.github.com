<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>My Realm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="og:type" content="blog">
<meta name="og:title">
<meta name="og:url" content="http://johnnyhuo.github.io/">
<meta name="og:image">
<meta name="og:site_name" content="My Realm">
<meta name="og:description">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="My Realm" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">My Realm</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://johnnyhuo.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-leetcodetwosum" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/16/leetcodetwosum/" class="article-date">
  <time datetime="2014-03-17T05:36:08.000Z" itemprop="datePublished">Mar 16 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/16/leetcodetwosum/">LeetCode:TwoSum (1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Given an array of integers, find two numbers such that they add up to a specific target number.</p>
<p>The function twoSum should return indices of the two numbers such that they add up to the target, where index1 must be less than index2. Please note that your returned answers (both index1 and index2) are not zero-based.</p>
<p>You may assume that each input would have exactly one solution.</p>
<p>Input: numbers={2, 7, 11, 15}, target=9
Output: index1=1, index2=2</p>
<p>OJ: </p>
<ul>
<li>首先用最笨的方法来解，不过好像Java Array的相关method我都忘得差不多了....记录下来再更正吧</li>
</ul>
<figure class="highlight Java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span>
    <span class="keyword">public</span> <span class="keyword">int</span>[] <span class="title">twoSum</span>(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) {
        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; 
        <span class="keyword">int</span> l = numbers.size();
        <span class="keyword">int</span> i, j;
        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l; i++){
            <span class="keyword">for</span>(<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; l; j++){
                <span class="keyword">if</span>(numbers[i] + numbers[j] = target){
                    result[<span class="number">0</span>] = i;
                    result[<span class="number">1</span>] = j;
                    <span class="keyword">return</span> result;
                }
            }
        }
        
    }
}
</pre></td></tr></table></figure>

<ul>
<li>Result:
  Line4: error: cannot find symbol: method size()</li>
<li><p>忘记有没有直接看Array长度的函数了，先不去查文档，转化成熟悉的String来做</p>
<figure class="highlight Java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span>
    <span class="keyword">public</span> <span class="keyword">int</span>[] <span class="title">twoSum</span>(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) {
        String source  = numbers.toString();
        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; 
        <span class="comment">//int l = numbers.size();</span>
        l = source.length();
        <span class="keyword">int</span> i, j;
        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l; i++){
            <span class="keyword">for</span>(<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; l; j++){
                <span class="keyword">if</span>(numbers[i] + numbers[j] = target){
                    result[<span class="number">0</span>] = i;
                    result[<span class="number">1</span>] = j;
                    <span class="keyword">return</span> result;
                }
            }
        }
        
    }
}
</pre></td></tr></table></figure>
</li>
<li><p>Result: 
  Line 6: error: cannot find symbol: variable l
  这个错误就是粗心大意了, 后面还有一个错误: 
  Line 9: error: variable j is already defined in method twoSum(int[],int)
  我还是再看一遍code再提交吧</p>
</li>
<li><p>审查了一遍,又发现个错误, i的边界判定不应该是length, 而应该是length - 1</p>
<figure class="highlight Java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span>
    <span class="keyword">public</span> <span class="keyword">int</span>[] <span class="title">twoSum</span>(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) {
        String source  = numbers.toString();
        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; 
        <span class="keyword">int</span> l = source.length();
        <span class="keyword">int</span> i, j;
        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l - <span class="number">1</span>; i++){
            <span class="keyword">for</span>(j = i + <span class="number">1</span>; j &lt; l; j++){
                <span class="keyword">if</span>(numbers[i] + numbers[j] = target){
                    result[<span class="number">0</span>] = i;
                    result[<span class="number">1</span>] = j;
                    <span class="keyword">return</span> result;
                }
            }
        }
        
    }
}
</pre></td></tr></table></figure>
</li>
<li><p>Result: 
  Line 9: error: unexpected type</p>
</li>
<li><p>太不严谨了 - -, 平常用eclipse确实有依赖性, 函数名自己都不去记了, 这种 &quot;==&quot; 自己居然也没注意到</p>
<figure class="highlight Java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span>
    <span class="keyword">public</span> <span class="keyword">int</span>[] <span class="title">twoSum</span>(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) {
        String source  = numbers.toString();
        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; 
        <span class="keyword">int</span> l = source.length();
        <span class="keyword">int</span> i, j;
        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l - <span class="number">1</span>; i++){
            <span class="keyword">for</span>(j = i + <span class="number">1</span>; j &lt; l; j++){
                <span class="keyword">if</span>(numbers[i] + numbers[j] == target){
                    result[<span class="number">0</span>] = i;
                    result[<span class="number">1</span>] = j;
                    <span class="keyword">return</span> result;
                }
            }
        }
        
    }
}
</pre></td></tr></table></figure>
</li>
<li><p>Result:
  Line 17: error: missing return statement</p>
</li>
<li><p>简直是错误百出</p>
<figure class="highlight Java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span>
    <span class="keyword">public</span> <span class="keyword">int</span>[] <span class="title">twoSum</span>(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) {
        String source  = numbers.toString();
        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; 
        <span class="keyword">int</span> l = source.length();
        <span class="keyword">int</span> i, j;
        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; l - <span class="number">1</span>; i++){
            <span class="keyword">for</span>(j = i + <span class="number">1</span>; j &lt; l; j++){
                <span class="keyword">if</span>(numbers[i] + numbers[j] == target){
                    result[<span class="number">0</span>] = i;
                    result[<span class="number">1</span>] = j;
                    <span class="keyword">return</span> result;
                }
            }
        }
        
        <span class="keyword">return</span> result;
        
    }
}
</pre></td></tr></table></figure>
</li>
<li><p>Result:
  Runtime Error Message:    Line 9: java.lang.ArrayIndexOutOfBoundsException: 3
  Last executed input:    [3,2,4], 6</p>
</li>
<li><p>再改!</p>
<figure class="highlight Java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span>
    <span class="keyword">public</span> <span class="keyword">int</span>[] <span class="title">twoSum</span>(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) {
        String source  = numbers.toString();
        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; 
        <span class="keyword">int</span> l = source.length();
        <span class="keyword">int</span> i, j;
        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= l - <span class="number">2</span>; i++){
            <span class="keyword">for</span>(j = i + <span class="number">1</span>; j &lt;= l - <span class="number">1</span>; j++){
                <span class="keyword">if</span>(numbers[i] + numbers[j] == target){
                    result[<span class="number">0</span>] = i + <span class="number">1</span>;
                    result[<span class="number">1</span>] = j + <span class="number">1</span>;
                    <span class="keyword">return</span> result;
                }
            }
        }
        
        <span class="keyword">return</span> result;
        
    }
}
</pre></td></tr></table></figure>
</li>
<li><p>Result:
Runtime Error Message:    Line 9: java.lang.ArrayIndexOutOfBoundsException: 3
Last executed input:    [3,2,4], 6</p>
</li>
<li><p><strong>IMPORTANT</strong>: 之所以会这样, 是因为Arrays.toString(), 并不是返回的Arrays里面元素的值, 比如 int[] numbers = {3, 2, 4}, 实测 System.out.println(numbers.toString()) 结果为 [I@53281264
所以上面code中的length实际为11, 怪不得会出现ArrayIndexOutOfBoundsException.</p>
</li>
</ul>
<h1 id="-arrays-arrays-length">正确获得Arrays长度的方法: Arrays.length</h1>
<p>之前刷提的时候不知所以然, 这次我们进阶了, 其实刚才写代码的时候也想到直接用 Arrays.length, 但是这个 .length不是一个method呀, 这在一切皆是Object的Java中显得有些不合群, 所以没用, 这次问题的出现是必然的,
因为我没有系统的学习过数据结构也好, 算法也好, Java也好, 以点带面, 查缺补漏吧.</p>
<p>还是参考<a href="http://stackoverflow.com/questions/9297899/arrays-length-property" target="_blank">StackOverflow</a>的解释:
    为什么ArrayList可以用ArrayList.size()来获取ArrayList的长度, 而 Array.length -- 并不是一个method, 却可以得到Array的长度呢? </p>
<p>  <a href="http://stackoverflow.com/a/9297956/2345313" target="_blank">Arrays are special objects in java</a>, they have <strong>a simple attribute named length which is final</strong>. 
  There is no &quot;class definition&quot; of an array (you can&#39;t find it in any .class file), they&#39;re a part of the language itself.</p>
<p>  <a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-10.html#jls-10.7" target="_blank">10.7. Array Members</a></p>
<blockquote>
<p>The members of an array type are all of the following:
The public final field length, which contains the number of components of the array. length may be positive or zero.
The public method clone, which overrides the method of the same name in class Object and throws no checked exceptions. The return type of the clone method of an array type T[] is T[].
A clone of a multidimensional array is shallow, which is to say that it creates only a single new array. Subarrays are shared.
All the members inherited from class Object; <strong>the only method of Object that is not inherited is its clone method.</strong>
<strong>Note also that ArrayList.size() provides the number of object actually stored in the array whereas myArray.length ([]) provides the &quot;capacity&quot;. That is, if for myArray = new int[10];, it returns 10. It is not the number of objects you&#39;ve put in the array.</strong></p>
</blockquote>
<ul>
<li><p>改正Arrays.length :</p>
<figure class="highlight Java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> {</span>
    <span class="keyword">public</span> <span class="keyword">int</span>[] <span class="title">twoSum</span>(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target) {
        String source  = numbers.toString();
        <span class="keyword">int</span>[] result = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>]; 
        <span class="comment">// int l = source.length();</span>
        <span class="keyword">int</span> l = numbers.length;
        <span class="keyword">int</span> i, j;
        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= l - <span class="number">2</span>; i++){
            <span class="keyword">for</span>(j = i + <span class="number">1</span>; j &lt;= l - <span class="number">1</span>; j++){
                <span class="keyword">if</span>(numbers[i] + numbers[j] == target){
                    result[<span class="number">0</span>] = i + <span class="number">1</span>;
                    result[<span class="number">1</span>] = j + <span class="number">1</span>;
                    <span class="keyword">return</span> result;
                }
            }
        }
        
        <span class="keyword">return</span> result;
        
    }
}
</pre></td></tr></table></figure>
</li>
<li><p>改正这一错误之后的代码可以正确运行了, 但是 leetcode的OJ表示此程序太慢了, Time Limit Exceeded. </p>
</li>
</ul>
<p>这并不出乎意料, 因为这个是最笨的方法, 时间复杂度应该是O(n^2)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://johnnyhuo.github.io/2014/03/16/leetcodetwosum/" data-id="lxtqsks18bc5uz21" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TwoSum/">TwoSum</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/">leetcode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-tcp和udp的不同" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/15/tcp和udp的不同/" class="article-date">
  <time datetime="2014-03-16T05:40:31.000Z" itemprop="datePublished">Mar 15 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/15/tcp和udp的不同/">tcp和udp的不同</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>转载自：<a href="http://www.diffen.com/difference/TCP_vs_UDP" target="_blank">http://www.diffen.com/difference/TCP_vs_UDP</a></p>
<p>There are two types of Internet Protocol (IP) traffic. They are TCP or Transmission Control Protocol and UDP or User Datagram Protocol. TCP is connection oriented = once a connection is established, data can be sent bidirectional. UDP is a simpler, connectionless Internet protocol. Multiple messages are sent as packets in chunks using UDP.</p>
<h2 id="differences-list">Differences List</h2>
<ul>
<li><p>Connection:</p>
<ul>
<li>TCP is a connection-oriented protocol.</li>
<li>UDP is a connectionless protocol.</li>
</ul>
</li>
<li><p>Functions: </p>
<ul>
<li>As a message makes its way across the internet from one computer to another. This is connection based.</li>
<li>UDP is also a protocol used in message transport or transfer. This is not connection based which means that one program can send a load of packets to another and that would be the end of the relationship.</li>
</ul>
</li>
<li><p>Usage:</p>
<ul>
<li>TCP is suited for applications that require high reliability, and transmission time is relatively less critical. </li>
<li>UDP is suitable for applications that need fast, efficient transmission, such as games. UDP&#39;s stateless nature is also useful for servers that answer small queries from huge numbers of clients.</li>
</ul>
</li>
<li><p>Examples: </p>
<ul>
<li>TCP: HTTP, HTTPs, FTP, SMTP, Telnet</li>
<li>UDP: DNS,  DHCP, TFTP, SNMP, RIP, VOIP</li>
</ul>
</li>
<li><p>Ordering of data packets</p>
<ul>
<li>TCP rearranges data packets in the order specified. </li>
<li>UDP has no inherent order as all packets are independent of each other. If ordering is required, it has to be managed by the application layer.</li>
</ul>
</li>
<li><p>Speed of transfer</p>
<ul>
<li>TCP is slower that UDP</li>
<li>UDP is faster because there is no error-checking for packets.</li>
</ul>
</li>
<li><p>Reliability</p>
<ul>
<li>There is absolute guarantee that the data transferred remains intact and arrives in the same order in which it was sent.</li>
<li>There is no guarantee that the messages or packets sent would reach at all.</li>
</ul>
</li>
<li><p>Header Size</p>
<ul>
<li>TCP header size is 20 bytes.</li>
<li>UDP Header size is 8 bytes.</li>
</ul>
</li>
<li><p>Common Header Fields</p>
<ul>
<li>TCP: Source port, Destination port, Check Sum.</li>
<li>UDP: Source port, Destination port, Check Sum.</li>
</ul>
</li>
<li><p>Streaming of Data</p>
<ul>
<li>TCP: Data is read as a <em>byte stream</em>, <em>no distinguishing indications</em> are transmitted to signal message(segment) boundaries.</li>
<li>UDP: Packets are sent <em>individually</em> and are checked for integrity <em>only if they arrive</em>. Packets have <strong>definite boundaries</strong> which are honored upon receipt, meaning a read operation at the receiver socket will yield an entire message as it was originally sent.</li>
</ul>
</li>
<li><p>Weight</p>
<ul>
<li>TCP is <strong>heavy-weight</strong>. TCP requires three packets to set up a socket connection, before any user data can be sent. TCP handles reliability and congestion control.</li>
<li>UDP is lightweight. There is no ordering of messages, no tracking connections, etc. It is a small transport layer designed on top of IP.</li>
</ul>
</li>
<li><p>Data Flow Control</p>
<ul>
<li>TCP does flow control. </li>
<li>UDP does not have an option for flow control.</li>
</ul>
</li>
<li><p>Error Checking</p>
<ul>
<li>TCP does error checking</li>
<li>UDP does error checking too, but no recovery options.</li>
</ul>
</li>
<li><p>Fields</p>
<ul>
<li>TCP: 1.Sequence Number, 2.AcK number, 3.Data offset, 4.Reserved, 5.Control bit, 6,Window, 7.Urgent Pointer, 8.Options, 9.Padding, 10.Check Sum, 11.Source port, 12.Destination port</li>
<li>UDP: 1.Length,2.Source port, 3.Destination port, 4.Check Sum.</li>
</ul>
</li>
<li><p>Acknowledgement</p>
<ul>
<li>TCP: Acknowledgement segments</li>
<li>UDP: No Acknowledgement</li>
</ul>
</li>
<li><p>Handshake</p>
<ul>
<li>TCP: SYN, SYN-ACK, ACK</li>
<li>UDP: No handshake(connectionless protocol)</li>
</ul>
</li>
<li><p>Checksum</p>
<ul>
<li>TCP: checksum</li>
<li>UDP: to delete errors.</li>
</ul>
<h2 id="differences-in-data-transfer-features">Differences in Data Transfer Features</h2>
<p>TCP ensures a reliable and ordered delivery of a stream of bytes from user to server or vice versa. UDP is not dedicated to end to end connections and communication does not check readiness of receiver.</p>
<h2 id="reliability">Reliability</h2>
<p>TCP is more reliable since it manages message acknowledgment and retransmissions in case of lost parts. Thus there is absolutely no missing data. UDP does not ensure that communication has reached receiver since concepts of acknowledgment, time out and retransmission are not present.</p>
<h2 id="ordering">Ordering</h2>
<p>TCP transmissions are sent in a sequence and they are received in the same sequence. In the event of data segments arriving in wrong order, TCP reorders and delivers application. In the case of UDP, sent message sequence may not be maintained when it reaches receiving application. There is absolutely no way of predicting the order in which message will be received.</p>
<h2 id="connection">Connection</h2>
<p>TCP is a heavy weight connection requiring three packets for a socket connection and handles congestion control and reliability. UDP is a lightweight transport layer designed atop an IP. There are no tracking connections or ordering of messages.</p>
<h2 id="method-of-transfer">Method of transfer</h2>
<p>TCP reads data as a byte stream and message is transmitted to segment boundaries. UDP messages are packets which are sent individually and on arrival are checked for their integrity. Packets have defined boundaries while ata stream has none.</p>
<h2 id="how-tcp-and-udp-work">How TCP and UDP work</h2>
<p>A TCP connection is established via a <a href="http://en.wikipedia.org/w/index.php?title=Transmission_Control_Protocol&amp;oldid=342876584#Connection_establishment" target="_blank">three way handshake</a>, which is a process of initiating and acknowledging a connection. Once the connection is established data transfer can begin. After transmission, the connection is terminated by closing of all established virtual circuits.</p>
<p>UDP uses a simple transmission model without implicit hand-shaking dialogues for guaranteeing reliability, ordering, or data integrity. Thus, UDP provides an unreliable service datagrams may arrive out of order, appear duplicated, or go missing without notice. UDP assumes that error checking and correction is either not necessary or performed in the application, avoiding the overhead of such processing at the network interface level. Unlike TCP, UDP is compatible with packet broadcasts(sending to all on local network) and multicasting(seng to all subscribers).</p>
<h2 id="different-applications-of-tcp-and-udp">Different Applications of TCP and UDP</h2>
<p>Web browsing, email and file transfer are common applications that make use of TCP. TCP is used to control segment size, rate of data exchange, flow control and network congestion. TCP is preferred where error correction facilities are required at network interface level. UDP is largely used by time sensitive applications as well as by servers that answer small queries from huge number of clients. UDP is compatible with packet broadcast - sending to all on a network and multicasting - sending to all subscribers. UDP is commonly used in Domain Name System, Voice over IP, Trivial File Transfer Protocol and online games.</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://johnnyhuo.github.io/2014/03/15/tcp和udp的不同/" data-id="1zw8z236w4ofdae3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tcp/">tcp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/udp/">udp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-接上：拖拖拉拉" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/15/接上：拖拖拉拉/" class="article-date">
  <time datetime="2014-03-16T00:09:08.000Z" itemprop="datePublished">Mar 15 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/15/接上：拖拖拉拉/">接上：拖拖拉拉</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="-">题外话：</h2>
<p>本来预定下周一到的耳机今天（周六）中午就到了，听了一下感觉音效不错，但是也就那么回事，而且卡耳朵卡得有点紧，心想要不要退掉或者卖掉，点回去Amazon一看，已经是正常价140刀了，还是捡了个大便宜呀，可惜用老婆的号买第二个被Amazon cancel了，原因应该是两个账号用的信用卡卡号是一样的...这样理想计划买二卖一泡汤了...不要太贪心嘛 </p>
<p>昨晚Larry请我去看电影，极品飞车，3D效果很爽，周五中午公司有披萨，结果一天没出办公室，屁股受不了，晚上本想回家的，下班太累，于是就给自己个借口去放松一下，结果错过老爸发来的Facetime，晚上11点半到家，打回去老爸问我干嘛去了，不想对老爸撒谎，如实说同事请看电影了，“咦也，你看人家”...羞愧难当</p>
<p>老父亲还卧病在床，不能在身边尽孝也抓紧时间做点正事吧！</p>
<h2 id="-">接上篇，基础问题</h2>
<h3 id="threads-and-processes-multithreading">threads and processes -- MultiThreading</h3>
<blockquote>
<p>Threads, of course, allow for multi-threading. A common example of the advantage of multithreading is the fact that you can have a word processor that prints a document using a background thread, but at the same time another thread is running that accepts user input, so that you can type up a new document.
If we were dealing with an application that uses only one thread, then the application would only be able to do one thing at a time – so printing and responding to user input at the same time would not be possible in a single threaded application.
Each process has it’s own address space, but the threads within the same process share that address space. Threads also share any other resources within that process. This means that it’s very easy to share data amongst threads, but it’s also easy for the threads to step on each other, which can lead to bad things.
Multithreaded programs must be carefully programmed to prevent those bad things from happening. Sections of code that modify data structures shared by multiple threads are called critical sections. When a critical section is running in one thread it’s extremely important that no other thread be allowed into that critical section. This is called synchronization, which we wont get into any further over here. But, the point is that multithreading requires careful programming.
Also, context switching between threads is generally less expensive than in processes. And finally, the overhead (the cost of communication) between threads is very low relative to processes.</p>
</blockquote>
<p><strong>SUMMARY</strong></p>
<blockquote>
<ol>
<li><p>Threads are easier to create than processes since they 
don&#39;t require a separate address space.</p>
</li>
<li><p>Multithreading requires careful programming since threads 
share data strucures that should only be modified by one thread
at a time.  Unlike threads, processes don&#39;t share the same 
address space.</p>
</li>
<li><p>Threads are considered lightweight because they use far 
less resources than processes.</p>
</li>
<li><p>Processes are independent of each other.  Threads, since they 
share the same address space are interdependent, so caution 
must be taken so that different threads don&#39;t step on each other.<br>This is really another way of stating #2 above.</p>
<ol>
<li>A process can consist of multiple threads.</li>
</ol>
</li>
</ol>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://johnnyhuo.github.io/2014/03/15/接上：拖拖拉拉/" data-id="68c83l5kt3p1u7ig" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/diary/">diary</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/interview/">interview</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/job hunting/">job hunting</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/thread & process/">thread & process</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-拖拖拉拉还是开始干正事吧" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/13/拖拖拉拉还是开始干正事吧/" class="article-date">
  <time datetime="2014-03-14T06:48:00.000Z" itemprop="datePublished">Mar 13 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/13/拖拖拉拉还是开始干正事吧/">拖拖拉拉还是开始干正事吧</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="-">时间流水账：</h2>
<p>7点半下班，7点45到家，没有做饭，随便吃吃蝴蝶酥+牛奶，到现在11点50，有4个小时的时间...看大酒神视频一个多小时，研究对比amazon上面thunderbolt转接线又不知过了多久，期间做了一点点正事就是把老婆要求的在职证明又重新扫描了一遍。
这种时间效率做什么都绝无成功之可能啊！</p>
<p>好了废话不多说，现在做一点有意义的事情。</p>
<h2 id="-">正事</h2>
<p>首先记录一下<a href="http://dp2.me/blog/" target="_blank">鹿牛的博客</a>，老早就收藏了，但也没怎么看，以后要多向鹿牛学习。罗大佑的《追梦人》，真是好听。</p>
<p>找工作感觉没什么头绪，感觉算法课要重新学一遍，操作系统也要学，编译原理，设计模式，Spring， Hibernate，统统都要学。。。不过感觉比较实际的还是直接做题，大哥也是这样说。
另外找工群里面BT阿姨整理的<a href="https://drive.google.com/#folders/0B1kacookxMZJZi1SRklBMkRjZmM" target="_blank">资料包</a>很好， 里面收录了一篇没怎么讲技术方面的东西，基本上是一些注意事项，读读也无妨，<strong>开卷有益</strong>嘛，摘录一点有用的东西：</p>
<blockquote>
<p>记不记得俺提到过的experience里要用“吓人”的动词？ 给你们一个小列表 （不是我的原创，不记得从哪儿抄来的了）。注意（1）全都是过去时; (2) 没有 studies, investigated, 
worked on, supported 这些无关痛痒的词。 </p>
<ol>
<li>Accelerated 35. Empowered 69. Motivated </li>
<li>Accomplished 36. Enabled 70. Negotiated </li>
<li>Achieved 37. Encouraged 71. Obtained </li>
<li>Acted 38. Engineered 72. Operated </li>
<li>Adapted 39. Enhanced 73. Orchestrated </li>
<li>Administered 40. Enlisted 74. Organized </li>
<li>Allocated 41. Established 75. Originated</li>
<li>Analyzed 42. Evaluated 76. Overhauled</li>
<li>Approved 43. Examined 77. Oversaw</li>
<li>Assembled 44. Executed 78. Performed </li>
<li>Attained 45. Expedited 79. Pinpointed </li>
<li>Boosted 46. Focused 80. Planned </li>
<li>Budgeted 47. Forecasted 81. Prepared </li>
<li>Built 48. Formulated 82. Prioritized </li>
<li>Calculated 49. Founded 83. Processed </li>
<li>Catalogued 50. Generated 84. Produced </li>
<li>Chaired 51. Guided 85. Reconciled </li>
<li>Coached 52. Harnessed 86. Repaired </li>
<li>Collaborated 53. Identified 87. Researched </li>
<li>Communicated 54. Illustrated 88. Revitalized </li>
<li>Compiled 55. Implemented 89. Selected </li>
<li>Consolidated 56. Improved 90. Solved </li>
<li>Coordinated 57. Increased 91. Spearheaded </li>
<li>Created 58. Initiated 92. Stimulated </li>
<li>Cultivated 59. Instituted 93. Strengthened </li>
<li>Decreased 60. Integrated 94. Succeeded </li>
<li>Demonstrated 61. Introduced 95. Surpassed </li>
<li>Designed 62. Invented 96. Synergized </li>
<li>Developed 63. Launched 97. Troubleshot </li>
<li>Diagnosed 64. Led 98. Uncovered </li>
<li>Directed 65. Maintained 99. Upgraded </li>
<li>Documented 66. Managed 100. Utilized </li>
<li>Doubled 67. Mastered </li>
<li>Educated 68. Mediated</li>
</ol>
</blockquote>
<p>这篇<a href="https://docs.google.com/file/d/0B1kacookxMZJVnlzN01hZllETVE/edit" target="_blank">码工求职经验总结</a>就比较靠谱了，非常推荐, 
其中<code>关于CS的基础知识</code>一段提到了几个面试中常问的基础问题，今天时间不早了，就挑些软柿子捏捏然后休息吧 ^^.</p>
<p>首先摘录下来这一段： </p>
<blockquote>
<p>以前看到有人问说OS/网络层/数据库的东西要不要准备。一般说来问题都取决于简历上的内容，如果简历上没有太多这方面的内容的话，基本上也不怎么会问。不过最基本的概念还是最好能了解，比如
进程和线程的不同，tcp和udp的不同，inner join和outerjoin的不同，等等。这些问题反映了一个人的CS基本功。
比如说简历上要是出现了concurrency的话，那下面这段出自<Get that job at Google>的话里提到的东西应该都要能够了解：</p>
<p>This is just a plug, from me, for you to know about processes, threads and
concurrency issues. A lot of interviewers ask about that stuff, and it&#39;s
pretty fundamental, so you should know it. Know about locks and mutexes and
semaphores and monitors and how they work. Know about deadlock and livelock
and how to avoid them. Know what resources a processes needs, and a thread
needs, and how context switching works, and how it&#39;s initiated by the
operating system and underlying hardware. Know a little about scheduling.
The world is rapidly moving towards multi-core, and you&#39;ll be a dinosaur in
a real hurry if you don&#39;t understand the fundamentals of &quot;modern&quot; (which is
to say, &quot;kinda broken&quot;) concurrency constructs.</p>
<p>还有就是C++/Java语言的一些基本概念，比如说构造函数、虚函数、接口之类。以及OO
的基本概念。</p>
</blockquote>
<p> 下面我就总结一下这几个基础问题吧，为了保证充分理解，又能够在面试中说得清楚，中英文的解释都网罗一下。</p>
<h3 id="-">进程和线程的不同</h3>
<ul>
<li><p><a href="http://blog.csdn.net/andy6355/article/details/2506171" target="_blank">中文</a></p>
<blockquote>
<p>进程和线程都是由操作系统所体会的程序运行的基本单元，系统利用该基本单元实现系统对应用的并发性。进程和线程的区别在于：
简而言之,一个程序至少有一个进程,一个进程至少有一个线程.
线程的划分尺度小于进程，使得多线程程序的并发性高。
另外，进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。
线程在执行过程中与进程还是有区别的。每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口。但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。
从逻辑角度来看，多线程的意义在于一个应用程序中，有多个执行部分可以同时执行。但操作系统并没有将多个线程看做多个独立的应用，来实现进程的调度和管理以及资源分配。这就是进程和线程的重要区别。
进程是具有一定独立功能的程序关于某个数据集合上的一次运行活动,进程是系统进行资源分配和调度的一个独立单位.
线程是进程的一个实体,是CPU调度和分派的基本单位,它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源,只拥有一点在运行中必不可少的资源(如程序计数器,一组寄存器和栈),但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源.
一个线程可以创建和撤销另一个线程;同一个进程中的多个线程之间可以并发执行.
进程和线程的主要差别在于它们是不同的操作系统资源管理方式。进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响，而线程只是一个进程中的不同执行路径。线程有自己的堆栈和局部变量，但线程之间没有单独的地址空间，一个线程死掉就等于整个进程死掉，所以多进程的程序要比多线程的程序健壮，但在进程切换时，耗费资源较大，效率要差一些。但对于一些要求同时进行并且又要共享某些变量的并发操作，只能用线程，不能用进程。如果有兴趣深入的话，我建议你们看看《现代操作系统》或者《操作系统的设计与实现》。对就个问题说得比较清楚。</p>
</blockquote>
</li>
<li><p><a href="http://www.programmerinterview.com/index.php/operating-systems/thread-vs-process/" target="_blank">English</a></p>
<blockquote>
<p>A process is an executing instance of an application. What does that mean? Well, for example, when you double-click the Microsoft Word icon, you start a process that runs Word. A thread is a path of execution within a process. Also, a process can contain multiple threads. When you start Word, the operating system creates a process and begins executing the primary thread of that process.</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>Both processes and threads are independent sequences of execution. The typical difference is that threads (of the same process) run in a shared memory space, while processes run in separate memory spaces.
Threads are an operating environment feature, rather than a CPU feature(though the CPU typically has operations that make threads efficient). Erlang uses the term &quot;process&quot; because it does not expose a 
shared-memory multiprogramming model. Calling them &quot;threads&quot; would imply that they have shared memory.</p>
</blockquote>
<ul>
<li><a href="http://www.programmerinterview.com/index.php/operating-systems/thread-vs-process/" target="_blank">Still English</a><blockquote>
<p>A process is an executing instance of an application. What does that mean? Well, for example, when you double-click the Microsoft Word icon, you start a process that runs Word. A thread is a path of execution within a process. Also, a process can contain multiple threads. When you start Word, the operating system creates a process and begins executing the primary thread of that process.</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>It’s important to note that a thread can do anything a process can do. But since a process can consist of multiple threads, a thread could be considered a ‘lightweight’ process. Thus, the essential difference between a thread and a process is the work that each one is used to accomplish. Threads are used for small tasks, whereas processes are used for more ‘heavyweight’ tasks – basically the execution of applications.</p>
<p>Another difference between a thread and a process is that threads within the same process share the same address space, whereas different processes do not. This allows threads to read from and write to the same data structures and variables, and also facilitates communication between threads. Communication between processes – also known as IPC, or inter-process communication – is quite difficult and resource-intensive.</p>
</blockquote>
<p>然后还有Multithreading的内容，已经2点了，就先睡觉吧， 刚刚和爸妈视频了一下，希望爸妈健康，快乐。</p>
<h2 id="ps-amazon-today-s-deal-harmon-kardon-cl-precision-http-www-amazon-com-gp-product-b00a3rvnxi-ref-ox_sc_act_title_1-ie-utf8-psc-1-smid-atvpdkikx0der-70-">PS. 今天Amazon today‘s deal，抢了两个 <a href="http://www.amazon.com/gp/product/B00A3RVNXI/ref=ox_sc_act_title_1?ie=UTF8&amp;psc=1&amp;smid=ATVPDKIKX0DER" target="_blank">Harmon Kardon CL Precision耳机</a>，才$70每个，看看老婆如果不要的话就卖掉一个 ^^  下了很大决心准备买三个呢，结果限购一个。算了，人不能太贪心嘛。</h2>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://johnnyhuo.github.io/2014/03/13/拖拖拉拉还是开始干正事吧/" data-id="d8p8a94b1552jc6a" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/diary/">diary</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/interview/">interview</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/job hunting/">job hunting</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/thread & process/">thread & process</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-@Value,spring,static-argument" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/13/@Value,spring,static-argument/" class="article-date">
  <time datetime="2014-03-13T07:29:49.000Z" itemprop="datePublished">Mar 13 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/13/@Value,spring,static-argument/">@Value,Spring,static-argument</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="-">遇到的问题：</h2>
<p>&emsp;&emsp;&emsp;&emsp;工作中遇到的情况，这次是要在billing-matrix包中的monitor加一个scheduler的feature，这个包也是采用MVC框架，mirror server上跑着这个程序， 访问<a href="http://54.203.255.103:8080/monitor/show.do便可检查Production" target="_blank">http://54.203.255.103:8080/monitor/show.do便可检查Production</a> Server的响应速度。而我要做的是统计一下这几项值的大致范围，选择出一个临界点，超过临界点就发邮件通知。原系统中已经有一个scheduler的程序，会周期性的把<code>monitorResult.toString( )</code> track到log中。而这个<code>monitorResult</code>又含有我需要监测的那些<code>field</code>，所以我要做的事情就比较简单了： </p>
<ul>
<li>确定各个<code>field</code>的临界值</li>
<li>写好发送<code>email</code>的<code>method</code></li>
</ul>
<h3 id="-values-annotation-"><code>@Values</code> annotation 赋值</h3>
<p>对于各个参数的赋值按说是没有难度的，但是我这次不想<code>hardcode</code>这些参数，而是用<code>properties</code>文件以及<code>@Values annotation</code>来赋值，这样程序会更加灵活。</p>
<p>关于如何使用<code>@Values</code>以及Spring来把properties中的value注入到Bean中，详见<a href="http://www.baeldung.com/2012/02/06/properties-with-spring/" target="_blank">这篇文章</a>。</p>
<p>按说跟着步骤来没什么难度，但实际实施起来还是出现了两个问题：</p>
<ul>
<li>自己不是太清楚classpath到底是指什么，<code>classpath</code>与<code>classpath*</code>有什么区别;</li>
<li>@Values总是注入不近来，导致NullPointerException.</li>
</ul>
<p>关于第一个问题，我引用[这里]（<a href="http://hi.baidu.com/huahua035/item/ac8a27a994b55bad29ce9d39）的解释：" target="_blank">http://hi.baidu.com/huahua035/item/ac8a27a994b55bad29ce9d39）的解释：</a></p>
<blockquote>
<p>web.xml中classpath是什么含义
简单理解，classpath就是代表  /WEB-INF /classes/  这个路径（如果不理解该路径，就把一个web工程发布为war包，然后用winrar查看其包内路径就理解啦）</p>
<p>常用的场景：
在SSH架构中，配置Spring的上下文环境：
<!-- Spring Configures -->
    <context-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>
            classpath:applicationContext.xml
        </param-value>
    </context-param></p>
<p>里面的
classpath:applicationContext.xml<br>也可以使用  /WEB-INF /classes/ applicationContext.xml  代替</p>
<p>注意：
classpath 和 classpath<em> <strong>区别</strong>：
classpath：只会到你的class路径中查找找文件;
classpath</em>：不仅包含class路径，还包括jar文件中(class路径)进行查找</p>
</blockquote>
<p>关于第二个问题： 我最初的想法是想把username等field声明为static的，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre>    <span class="annotation">@Value</span>(<span class="string">"${monitor.email.username:#{null}}"</span>)
	<span class="keyword">static</span> <span class="keyword">private</span> String username;
	
	<span class="annotation">@Value</span>(<span class="string">"${monitor.email.password:#{null}}"</span>)
	<span class="keyword">static</span> <span class="keyword">private</span> String password;
	
	<span class="annotation">@Value</span>(<span class="string">"${monitor.email.fromemail:#{null}}"</span>)
	<span class="keyword">static</span> <span class="keyword">private</span> String fromEmail;
	
	<span class="annotation">@Value</span>(<span class="string">"${monitor.email.toemail.notserious:#{null}}"</span>)
	<span class="keyword">private</span> String toEmailNotSerious;

	<span class="annotation">@Value</span>(<span class="string">"${monitor.email.toemail.serious:#{null}}"</span>)
	<span class="keyword">private</span> String toEmailSerious;
</pre></td></tr></table></figure>

<p>但是事实证明value注入不进来的原因就是<strong>static</strong>， 发现自己对于static的认识还是不够，下面引用<a href="http://stackoverflow.com/a/413904/2345313" target="_blank">stack overflow</a>上别人的解答</p>
<blockquote>
<p>static members belong to the class instead of a specific instance.</p>
<p>It means that only one instance of a static field exists even if you create a million instances of the class or you don&#39;t create any. It will be shared by all instances.</p>
<p>Since static methods also do not belong to a specific instance, they can&#39;t refer to instance members (how would you know which instance Hello class you want to refer to?). static members can only refer to static members. Instance members can, of course access static members.</p>
<p>Side note: Of course, static members can access instance members through an object reference.</p>
</blockquote>
<p>但是没有找到非常适合这个case的解释，我觉得可能Spring在把这个value注入到Bean中时是属于instance范畴的，而不是calss，因为Bean是一个Object，臆测。。总之删掉static就可正常赋值</p>
<h3 id="-email-"><strong>发送email</strong></h3>
<p>我的代码是这样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
</pre></td><td class="code"><pre><span class="keyword">package</span> com.fuhu.osg.billing.matrix.scheduler;

<span class="keyword">import</span> java.util.ArrayList;
<span class="keyword">import</span> java.util.HashMap;
<span class="keyword">import</span> java.util.Iterator;
<span class="keyword">import</span> java.util.List;
<span class="keyword">import</span> java.util.Map;
<span class="keyword">import</span> java.util.Properties;
<span class="keyword">import</span> java.util.Queue;
<span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;

<span class="keyword">import</span> org.apache.log4j.Logger;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;
<span class="keyword">import</span> org.springframework.stereotype.Component;

<span class="keyword">import</span> com.fuhu.osg.billing.matrix.data.json.MonitorObject;
<span class="keyword">import</span> com.fuhu.osg.billing.matrix.factory.AnalyzeFactory;
<span class="keyword">import</span> com.fuhu.osg.billing.matrix.util.DataUtil;
<span class="keyword">import</span> com.fuhu.osg.billing.matrix.util.FileUtil;
<span class="keyword">import</span> com.fuhu.osg.billing.restclient.MonitorRESTClient;
<span class="keyword">import</span> com.fuhu.osg.billing.result.MonitorResult;
<span class="keyword">import</span> com.fuhu.osg.util.Constants;
<span class="keyword">import</span> java.util.Properties;
<span class="keyword">import</span> javax.mail.Message;
<span class="keyword">import</span> javax.mail.MessagingException;
<span class="keyword">import</span> javax.mail.PasswordAuthentication;
<span class="keyword">import</span> javax.mail.Session;
<span class="keyword">import</span> javax.mail.Transport;
<span class="keyword">import</span> javax.mail.internet.InternetAddress;
<span class="keyword">import</span> javax.mail.internet.MimeMessage;

<span class="annotation">@Component</span>
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatrixScheduler</span> {</span>

	<span class="keyword">private</span> <span class="keyword">static</span> Logger logger = Logger.getLogger(MatrixScheduler.class);

	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Queue&lt;MonitorResult&gt;&gt; serverMap = <span class="keyword">new</span> HashMap&lt;String, Queue&lt;MonitorResult&gt;&gt;();

	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; serverList = <span class="keyword">new</span> ArrayList&lt;String&gt;();
	<span class="annotation">@Autowired</span>
	<span class="keyword">private</span> MonitorRESTClient client;

	<span class="annotation">@Value</span>(<span class="string">"${monitorEmailUsername}#{null}"</span>)
	<span class="keyword">private</span> String username;

	<span class="annotation">@Value</span>(<span class="string">"${monitorEmailPassword}"</span>)
	<span class="keyword">private</span> String password;

	<span class="annotation">@Value</span>(<span class="string">"${monitorFromEmail}"</span>)
	<span class="keyword">private</span> String fromEmail;

	<span class="annotation">@Value</span>(<span class="string">"${monitorToEmailNotSerious}"</span>)
	<span class="keyword">private</span> String toEmailNotSerious;

	<span class="annotation">@Value</span>(<span class="string">"${monitorToEmailSerious}"</span>)
	<span class="keyword">private</span> String toEmailSerious;

	<span class="keyword">boolean</span> serious;

	<span class="annotation">@Scheduled</span>(cron = <span class="string">"${monitor.scheduler}"</span>)
	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">monitorActivated</span>() {
		MonitorResult result = client.monitorStatus();

		Queue&lt;MonitorResult&gt; queue = <span class="keyword">null</span>;
		<span class="keyword">if</span> (serverMap.get(result.getServerId()) == <span class="keyword">null</span>) {
			queue = <span class="keyword">new</span> ArrayBlockingQueue&lt;MonitorResult&gt;(<span class="number">48</span>);
			serverMap.put(result.getServerId(), queue);
			serverList.add(result.getServerId());
		} <span class="keyword">else</span> {
			queue = serverMap.get(result.getServerId());
		}

		<span class="keyword">if</span> (queue.size() == <span class="number">48</span>) {
			queue.poll();
		}
		<span class="keyword">if</span> (result.getStatus().equals(Constants.SUCCESS)) {
			queue.add(result);
		} <span class="keyword">else</span> {
			queue.add(<span class="keyword">new</span> MonitorResult());
		}
		logger.trace(result.toString());
		<span class="comment">// for data analysis</span>
		<span class="keyword">if</span> (result.getTotalRTT() != <span class="number">0.0</span>) {
			System.out.println(<span class="string">"Result is --&gt; "</span> + result.toString());
		}
		StringBuilder sBuilder = <span class="keyword">new</span> StringBuilder();
		<span class="keyword">if</span> (result.getCoppaRTT() &gt; <span class="number">500</span>) {
			<span class="comment">// send email</span>
			String content = <span class="string">"CoppaRTT is above 500"</span>;
			serious = <span class="keyword">false</span>;

			sendEmail(content, username, password, fromEmail, toEmailNotSerious, toEmailSerious);
		}

	}

	<span class="keyword">public</span> <span class="keyword">static</span> Queue&lt;MonitorResult&gt; <span class="title">getDataQueue</span>(String serverId) {
		<span class="keyword">return</span> serverMap.get(serverId);
	}

	<span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getServerList</span>() {
		<span class="keyword">return</span> serverList;
	}

<span class="comment">//	inner class uses username & password, so use final parameter.</span>
	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendEmail</span>(String content, <span class="keyword">final</span> String username, <span class="keyword">final</span> String password, String fromEmail, String toEmailNotSerious , String toEmailSerious) {
		Properties props = <span class="keyword">new</span> Properties();
		props.put(<span class="string">"mail.smtp.host"</span>, <span class="string">"smtp.gmail.com"</span>);
		props.put(<span class="string">"mail.smtp.socketFactory.port"</span>, <span class="string">"465"</span>);
		props.put(<span class="string">"mail.smtp.socketFactory.class"</span>,
				<span class="string">"javax.net.ssl.SSLSocketFactory"</span>);
		props.put(<span class="string">"mail.smtp.auth"</span>, <span class="string">"true"</span>);
		props.put(<span class="string">"mail.smtp.port"</span>, <span class="string">"465"</span>);

		Session session = Session.getDefaultInstance(props,
				<span class="keyword">new</span> javax.mail.Authenticator() {
					<span class="keyword">protected</span> PasswordAuthentication <span class="title">getPasswordAuthentication</span>() {
						<span class="keyword">return</span> <span class="keyword">new</span> PasswordAuthentication(username, password);
					}
				});

		<span class="keyword">try</span> {

			Message message = <span class="keyword">new</span> MimeMessage(session);
			message.setFrom(<span class="keyword">new</span> InternetAddress(fromEmail));
			<span class="keyword">if</span> (serious) {
				message.setRecipients(Message.RecipientType.TO,
						InternetAddress.parse(toEmailSerious));
			} <span class="keyword">else</span> {
				message.setRecipients(Message.RecipientType.TO,
						InternetAddress.parse(toEmailNotSerious));
			}
			message.setSubject(<span class="string">"Server Monitor Warning"</span>);
			message.setText(<span class="string">"Attention, server in danger "</span> + content);
			Transport.send(message);
		} <span class="keyword">catch</span> (MessagingException e) {
			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);
		}
	}

}
</pre></td></tr></table></figure>

<p>这里sendEmail（）有一点tricky的地方，就是用了<code>final variable</code>, <code>final String username</code> &amp; <code>final String password</code>, 这是因为sendEmail（）method中的<code>inner class</code>使用了这两个<code>argument</code>. 原因：</p>
<blockquote>
<p>There are two main reasons you might want to mark an argument final. First, if you&#39;re planning on using the argument in an anonymous inner class, then you must mark it final so that it can be referenced in that class. This is actually a pretty common use case for marking arguments final.</p>
<p>The other common reason to mark arguments final is to prevent yourself from accidentally overwriting them. If you really don&#39;t want to change the arguments, then perhaps you should mark them final so that if you actually do, you&#39;ll get the error at compile-time rather than finding out at runtime that your code has a bug.</p>
</blockquote>
<p>详见<a href="http://stackoverflow.com/a/4930124/2345313" target="_blank">stack overflow</a>的解释。</p>
<h6 id="markdown-">Markdown首行缩进：</h6>
<p><code>&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;这是段落1
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;这是段落2
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这是段落3
无段落</code></p>
<h6 id="-">效果如下：</h6>
<p>&ensp;&ensp;&ensp;&ensp;这是段落1
&emsp;&emsp;&emsp;&emsp;这是段落2
&nbsp;&nbsp;&nbsp;&nbsp;这是段落3
无段落</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://johnnyhuo.github.io/2014/03/13/@Value,spring,static-argument/" data-id="9fjwe4alr2s09hqv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/">Spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Work/">Work</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-test" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/13/test/" class="article-date">
  <time datetime="2014-03-13T07:21:11.000Z" itemprop="datePublished">Mar 13 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/13/test/">终于搞定博客了</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="hello-world-">Hello World...</h1>
<p>搞定博客！OH Yeah！</p>
<p>前前后后搞了好几天，终于算是告一段落了，从最开始的<code>Jekyll</code>到<code>octopress</code>，最后到<code>Hexo</code>，看了很多教程，期间学习了<code>git</code>和<code>Markdown</code>，总是有收获的嘛！</p>
<p>从最终结果来看，主要参考下面几篇文章就可以搭建出来自己的<code>Hexo Blog</code>了</p>
<ul>
<li><p><a href="http://jimliu.net/2013/09/08/%E4%BD%BF%E7%94%A8hexo%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/" target="_blank">使用hexo搭建静态博客</a></p>
</li>
<li><p><a href="http://wowubuntu.com/markdown/" target="_blank">Markdown 语法说明</a></p>
</li>
<li><p><a href="http://rogerdudler.github.io/git-guide/index.zh.html" target="_blank">git - 简明指南</a></p>
</li>
</ul>
<p>还有一些有待完善的地方，比如一些可以留言或者订阅的plugin啊，另外还有一个小tip，就是md文件标记多个tag的时候使用<a href="https://zh.wikipedia.org/wiki/YAML" target="_blank">YAML</a>格式:</p>
<p><code>tags:</code>
<code>换行-123</code>
<code>换行-456</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://johnnyhuo.github.io/2014/03/13/test/" data-id="3cgf1kuza4q9gwze" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/03/13/hello-world/" class="article-date">
  <time datetime="2014-03-13T07:04:54.000Z" itemprop="datePublished">Mar 13 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/13/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="http://zespia.tw/hexo" target="_blank">Hexo</a>! This is your very first post. Check <a href="http://zespia.tw/hexo/docs" target="_blank">documentation</a> to learn how to use.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://johnnyhuo.github.io/2014/03/13/hello-world/" data-id="mshg7j7b0fsduzaa" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TwoSum/">TwoSum</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Work/">Work</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/diary/">diary</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interview/">interview</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/job hunting/">job hunting</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tcp/">tcp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread & process/">thread & process</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/udp/">udp</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Spring/" style="font-size: 10.00px;">Spring</a><a href="/tags/TwoSum/" style="font-size: 10.00px;">TwoSum</a><a href="/tags/Work/" style="font-size: 10.00px;">Work</a><a href="/tags/diary/" style="font-size: 20.00px;">diary</a><a href="/tags/interview/" style="font-size: 20.00px;">interview</a><a href="/tags/job hunting/" style="font-size: 20.00px;">job hunting</a><a href="/tags/leetcode/" style="font-size: 10.00px;">leetcode</a><a href="/tags/tcp/" style="font-size: 10.00px;">tcp</a><a href="/tags/thread & process/" style="font-size: 20.00px;">thread & process</a><a href="/tags/udp/" style="font-size: 10.00px;">udp</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03">March 2014</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/03/16/leetcodetwosum/">LeetCode:TwoSum (1)</a>
          </li>
        
          <li>
            <a href="/2014/03/15/tcp和udp的不同/">tcp和udp的不同</a>
          </li>
        
          <li>
            <a href="/2014/03/15/接上：拖拖拉拉/">接上：拖拖拉拉</a>
          </li>
        
          <li>
            <a href="/2014/03/13/拖拖拉拉还是开始干正事吧/">拖拖拉拉还是开始干正事吧</a>
          </li>
        
          <li>
            <a href="/2014/03/13/@Value,spring,static-argument/">@Value,Spring,static-argument</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 John Doe<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script type="text/javascript" src="/js/script.js"></script>
  </div>
</body>
</html>